import{_ as s,c as i,a,d as n,o as l}from"./app-CH5USNLT.js";const e="/assets/image-20240725171622658-CEa2iM4D.png",t="/assets/image-20240725171228632-jDbQAo3F.png",h="/assets/image-20240725171552804-NOvNxWnK.png",p="/assets/image-20240725183051071-3NnM-mq8.png",k="/assets/image-20240725183104336-DNbr-9R3.png",d="/assets/image-20240725183124075-BcNRFmw4.png",r={},g=n(`<h3 id="_1-添加yml文件" tabindex="-1"><a class="header-anchor" href="#_1-添加yml文件"><span>1. 添加yml文件</span></a></h3><p>blogs/.github/workflows/npm-publish-github-packages.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Build and Deploy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  push</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    branches</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">jobs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  build-and-deploy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    runs-on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    steps</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Checkout source code</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      uses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">actions/checkout@v3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Setup Node.js</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      uses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">actions/setup-node@v3</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        node-version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;18&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # 或者您项目需要的 Node.js 版本</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Install pnpm</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">npm install -g pnpm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Install dependencies</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pnpm install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Build project</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pnpm run docs:build</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # 确保 package.json 中有 &quot;docs:build&quot; 脚本</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Deploy to GitHub Pages</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      uses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">JamesIves/github-pages-deploy-action@v4</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\${{ github.ref == &#39;refs/heads/main&#39; }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        branch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">gh-pages//这个是存储你项目打包后的文件分支</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        folder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dist</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\${{ secrets.TOKEN }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Deploy to server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      uses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">appleboy/ssh-action@master</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\${{ secrets.HOST }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\${{ secrets.USERNAME }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\${{ secrets.SSH_PRIVATE_KEY }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\${{ secrets.PORT }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        script</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">|</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          cd /www/wwwroot/www.yzyx.fun/blogs  # 替换为您的项目在服务器上的位置</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          git pull origin gh-pages # 拉取最新代码</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码仓库--&gt;Actions--&gt;Now workflow--&gt;Publish Node.js Package to GitHub Packages(第二行中间)</p><p>然后你的项目就会出现这个脚本文件，并对脚本文件进行细节上的修改。</p><figure><img src="`+e+'" alt="workflow" tabindex="0" loading="lazy"><figcaption>workflow</figcaption></figure><h3 id="_2-设置环境" tabindex="-1"><a class="header-anchor" href="#_2-设置环境"><span>2. 设置环境</span></a></h3><ul><li>TOKEN</li></ul><p>​ Setting（GitHub）--&gt;Developer setting（左侧边栏最下面）--&gt;Token（classic）记得记录一下</p><p>​ 长这样：ghp_gZGZzXVwmLPYn6aBCt4O6ZZ9Fh42eSop3（我随机删了两个字符）</p><ul><li>SSH公私钥</li></ul><p>​ SSH公私钥在本地终端或服务器终端使用命令行创建（无论在哪创建，最好都要使另一个也要复制过去）</p><p>​ 本地存放在C:\\Users\\yeqic.ssh，服务器存放在/root/.ssh</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssh-keygen</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rsa</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -b</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 4096</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;your_email@example.com&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>​ 公钥添加到GitHub的SSH keys中,私钥添加到下面的secrets中</p><figure><img src="'+t+'" alt="SSH keys" tabindex="0" loading="lazy"><figcaption>SSH keys</figcaption></figure><ul><li>添加到secrets</li></ul><p>​ Setting（代码仓库）--&gt;Secrets and variables--&gt;Actions--&gt;New repository secret（Name字符都要大写）</p><table><thead><tr><th style="text-align:center;">Name</th><th style="text-align:center;">内容</th></tr></thead><tbody><tr><td style="text-align:center;">secrets.TOKEN</td><td style="text-align:center;">例：ghp_gZGZzXVwmLPYn6aBCt4O6ZZ9Fh42eSop3</td></tr><tr><td style="text-align:center;">secrets.HOST</td><td style="text-align:center;">服务器地址（例：123.322.42.5）</td></tr><tr><td style="text-align:center;">secrets.USERNAME</td><td style="text-align:center;">服务器用户名：root</td></tr><tr><td style="text-align:center;">secrets.SSH_PRIVATE_KEY</td><td style="text-align:center;">ssh私钥</td></tr><tr><td style="text-align:center;">secrets.PORT</td><td style="text-align:center;">22</td></tr></tbody></table><figure><img src="'+h+'" alt="Secrets" tabindex="0" loading="lazy"><figcaption>Secrets</figcaption></figure><h3 id="_3-整体思想" tabindex="-1"><a class="header-anchor" href="#_3-整体思想"><span>3. 整体思想</span></a></h3><p>​ 设计一个脚本来实现项目的自动化部署，本地将项目push到GitHub仓库时，push会触发这个脚本，GitHub会开启一个ubuntu的服务器，来处理我们这个脚本，执行pnpm run docs:build打包我们的项目生成dist文件，再将这个dist文件存放在我们GitHub仓库的另一个分支gh-pages上。然后在服务器的/www/wwwroot/www.yzyx.fun/blogs目录上执行git pull origin gh-pages拉取gh-pages分支上的最新代码，最后部署到我们的服务器上。</p><figure><img src="'+p+'" alt="blogs" tabindex="0" loading="lazy"><figcaption>blogs</figcaption></figure><figure><img src="'+k+'" alt="main" tabindex="0" loading="lazy"><figcaption>main</figcaption></figure><figure><img src="'+d+'" alt="gh-pages" tabindex="0" loading="lazy"><figcaption>gh-pages</figcaption></figure>',25);function c(y,o){return l(),i("div",null,[a(" more "),g])}const A=s(r,[["render",c],["__file","GItHub Action.html.vue"]]),m=JSON.parse('{"path":"/books/GitHub/GItHub%20Action.html","title":"GitHub Actions工作流自动化部署","lang":"zh-CN","frontmatter":{"title":"GitHub Actions工作流自动化部署","cover":"/assets/images/15.jpg","date":"2024-07-25T00:00:00.000Z","category":["GitHub"],"tag":["学习资料"]},"headers":[{"level":3,"title":"1. 添加yml文件","slug":"_1-添加yml文件","link":"#_1-添加yml文件","children":[]},{"level":3,"title":"2. 设置环境","slug":"_2-设置环境","link":"#_2-设置环境","children":[]},{"level":3,"title":"3. 整体思想","slug":"_3-整体思想","link":"#_3-整体思想","children":[]}],"git":{"createdTime":1721910115000,"updatedTime":1721910115000,"contributors":[{"name":"yunzhongyue","email":"15737369015@163.com","commits":1}]},"readingTime":{"minutes":1.97,"words":592},"filePathRelative":"books/GitHub/GItHub Action.md","localizedDate":"2024年7月25日","excerpt":""}');export{A as comp,m as data};
